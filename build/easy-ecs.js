Object.defineProperty(exports,"__esModule",{value:!0});var t={};Object.defineProperty(t,"__esModule",{value:!0});var e=(l=void 0,p=t.Addon=l,d=t.World=p,b=t.Entity=d,t.Component=b);t.System=e;var n={};Object.defineProperty(n,"__esModule",{value:!0});var r=function(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(t){return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}))};function o(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function c(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.UUID=r;var s=function t(){throw f(this,t),Error("Easy-ECS: Cannot instantiate class Addon")},l=s;t.Addon=l,a(s,"onInit",(function(t){})),a(s,"onBeforeUpdate",(function(t,e){})),a(s,"onAfterUpdate",(function(t,e){}));var p=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{addons:[],systems:[]};f(this,t),a(this,"addons",[]),a(this,"systems",[]),a(this,"entities",[]),this.addons=n.addons,n.systems.forEach((function(t){e.systems=[].concat(o(e.systems),[new t(e)])}))}return c(t,[{key:"addEntity",value:function(t){this.entities.push(t)}},{key:"removeEntity",value:function(t){if(-1===this.entities.indexOf(t))return console.warn("Easy-ECS: Cannot remove entity from world",t);this.entities.splice(this.entities.indexOf(t),1)}},{key:"getEntitiesWithComponents",value:function(t){return t.length?this.entities.filter((function(e){return t.every((function(t){return e.components.indexOf(t.name)>=0}))})):this.entities}},{key:"getEntitiesOfType",value:function(t){return this.entities.filter((function(e){return e.constructor===t}))}},{key:"getEntityById",value:function(t){return this.entities.find((function(e){return e.id===t}))}},{key:"start",value:function(){var t=this;this.addons.forEach((function(e){return e.onInit(t)})),this.systems.forEach((function(e){var n=t.getEntitiesWithComponents(e.dependencies);e.onInit(n)}))}},{key:"update",value:function(t){var e=this;this.addons.forEach((function(n){return n.onBeforeUpdate(e,t)})),this.systems.forEach((function(t){var n=e.getEntitiesWithComponents(t.dependencies);t.onUpdate(n)})),this.addons.forEach((function(n){return n.onAfterUpdate(e,t)}))}}]),t}();t.World=p;var y=function(){function t(e,r){var o=this;f(this,t),a(this,"id",(0,n.UUID)()),a(this,"components",[]),a(this,"world",null),this.constructor.components.forEach((function(t){o.addComponent(t,r)})),this.world=e,e.addEntity(this)}return c(t,[{key:"addComponent",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.props.forEach((function(r){e[r]&&"name"!==r&&console.warn("Easy-ECS: Entity prop ".concat(r," overwrite by component ").concat(t.name),e),e[r]=n[r]?n[r]:t[r]})),this.components.push(t.name)}},{key:"removeComponent",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];-1!==this.components.indexOf(t.name)&&(this.components.splice(this.components.indexOf(t.name),1),t.props&&n&&t.props.forEach((function(t){delete e[t]})))}},{key:"serialize",value:function(){var t=this,e={};return Object.keys(this).forEach((function(n){return"world"!==n&&"name"!==n&&(e[n]=t[n])})),JSON.stringify(e)}},{key:"unserialize",value:function(t){var e=this,n=JSON.parse(t);Object.keys(n).forEach((function(t){e[t]=n[t]}))}},{key:"destroy",value:function(){this.world.removeEntity(this)}}]),t}(),d=y;t.Entity=d,a(y,"components",[]);var h=function(){function t(){throw f(this,t),Error("Easy-ECS: Cannot instantiate class Component")}return c(t,null,[{key:"props",get:function(){var t=[];for(var e in this)t.push(e);return t}}]),t}(),b=h;t.Component=b,a(h,"name","Unnamed Component");e=function t(e){f(this,t),a(this,"dependencies",[]),a(this,"world",null),a(this,"onInit",(function(t){})),a(this,"onUpdate",(function(t){})),this.world=e},t.System=e,Object.keys(t).forEach((function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(exports,e,{enumerable:!0,get:function(){return t[e]}})}));var m={};Object.defineProperty(m,"__esModule",{value:!0}),Object.defineProperty(m,"Time",{enumerable:!0,get:function(){return v.Time}}),Object.defineProperty(m,"Loop",{enumerable:!0,get:function(){return A.Loop}}),Object.defineProperty(m,"Input",{enumerable:!0,get:function(){return z.Input}}),Object.defineProperty(m,"Renderer",{enumerable:!0,get:function(){return Z.Renderer}}),Object.defineProperty(m,"SaveSystem",{enumerable:!0,get:function(){return at.SaveSystem}});var v={};Object.defineProperty(v,"__esModule",{value:!0});var O=void 0;function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){return(S=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=E(t);if(e){var o=E(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return j(this,n)}}function j(t,e){return!e||"object"!==w(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function E(t){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function P(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}v.Time=O;var R=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&S(t,e)}(r,t.Addon);var n=_(r);function r(){return g(this,r),n.apply(this,arguments)}return r}();O=R,v.Time=O,P(R,"time",0),P(R,"delta",0),P(R,"elapsed",0),P(R,"onBeforeUpdate",(function(t,e){R.delta=e-R.time,R.time=e,R.elapsed+=R.delta}));var A={};Object.defineProperty(A,"__esModule",{value:!0});var I=void 0;function x(t){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function C(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function k(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function U(t,e){return(U=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=M(t);if(e){var o=M(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return D(this,n)}}function D(t,e){return!e||"object"!==x(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function M(t){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function N(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}A.Loop=I;var L=null,W=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&U(t,e)}(u,t.Addon);var n,r,o,i=T(u);function u(){return C(this,u),i.apply(this,arguments)}return n=u,o=[{key:"isRunning",get:function(){return null!==L}}],(r=null)&&k(n.prototype,r),o&&k(n,o),u}();I=W,A.Loop=I,N(W,"loop",(function(t){L=requestAnimationFrame(t.update.bind(t))})),N(W,"stop",(function(){cancelAnimationFrame(L),L=null})),N(W,"onInit",(function(t){W.loop(t)})),N(W,"onBeforeUpdate",(function(t){W.loop(t)}));var z={};Object.defineProperty(z,"__esModule",{value:!0});var B=void 0;function J(t){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function F(t){return function(t){if(Array.isArray(t))return $(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return $(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function q(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(t,e){return(G=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function H(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=X(t);if(e){var o=X(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return V(this,n)}}function V(t,e){return!e||"object"!==J(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}z.Input=B;var K=[],Q=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&G(t,e)}(r,t.Addon);var n=H(r);function r(){return q(this,r),n.apply(this,arguments)}return r}();B=Q,z.Input=B,Y(Q,"keypress",null),Y(Q,"mouse",{x:0,y:0}),Y(Q,"INPUT_LEFT","ArrowLeft"),Y(Q,"INPUT_RIGHT","ArrowRight"),Y(Q,"INPUT_UP","ArrowUp"),Y(Q,"INPUT_DOWN","ArrowDown"),Y(Q,"INPUT_SPACE","Space"),Y(Q,"onInit",(function(t){document.addEventListener("keydown",(function(t){-1===K.indexOf(t.code)&&(K=[].concat(F(K),[t.code]))})),document.addEventListener("keyup",(function(t){K.splice(K.indexOf(t.code),1)})),document.addEventListener("mousemove",(function(t){Q.mouse={x:t.clientX,y:t.clientY}}))})),Y(Q,"onBeforeUpdate",(function(t){Q.keypress=K})),Y(Q,"onAfterUpdate",(function(t){Q.keypress=null})),Y(Q,"isPressed",(function(t){return-1!==Q.keypress.indexOf(t)}));var Z={};Object.defineProperty(Z,"__esModule",{value:!0});var tt=void 0;function et(t){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rt(t,e){return(rt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ot(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=ut(t);if(e){var o=ut(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return it(this,n)}}function it(t,e){return!e||"object"!==et(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function ut(t){return(ut=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ct(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}Z.Renderer=tt;var ft=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&rt(t,e)}(r,t.Addon);var n=ot(r);function r(){return nt(this,r),n.apply(this,arguments)}return r}();tt=ft,Z.Renderer=tt,ct(ft,"canvas",null),ct(ft,"ctx",null),ct(ft,"width",0),ct(ft,"height",0),ct(ft,"worldScale",1),ct(ft,"setup",(function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;ft.canvas=t,ft.width=e,ft.height=n,ft.worldScale=r,ft.ctx=ft.canvas.getContext("2d"),ft.canvas.width=ft.width*ft.worldScale,ft.canvas.height=ft.height*ft.worldScale,ft.canvas.style.width=ft.width,ft.canvas.style.height=ft.height,window.addEventListener("resize",(function(){ft.onResize()}))})),ct(ft,"onResize",(function(){})),ct(ft,"onBeforeUpdate",(function(t){ft.ctx.clearRect(0,0,ft.canvas.width,ft.canvas.height)}));var at={};Object.defineProperty(at,"__esModule",{value:!0});var st=void 0;function lt(t){return(lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){return(yt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function dt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=bt(t);if(e){var o=bt(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ht(this,n)}}function ht(t,e){return!e||"object"!==lt(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function bt(t){return(bt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function mt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}at.SaveSystem=st;var vt=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yt(t,e)}(r,t.Addon);var n=dt(r);function r(){return pt(this,r),n.apply(this,arguments)}return r}();st=vt,at.SaveSystem=st,mt(vt,"saveWorld",(function(t,e){var n={timestamp:Date.now(),entities:t.entities.map((function(t){return t.serialize()}))};return localStorage.setItem("worldsave-".concat(e),JSON.stringify(n)),n})),mt(vt,"restoreWorld",(function(e,n){var r=localStorage.getItem("worldsave-".concat(n)),o=JSON.parse(r);e.entities=[],o.entities.forEach((function(n){new t.Entity(e).unserialize(n)}))})),mt(vt,"saveData",(function(t,e){localStorage.setItem("data-".concat(t),JSON.stringify(e))})),mt(vt,"restoreData",(function(t){var e=localStorage.getItem("data-".concat(t));return e?JSON.parse(e):null})),Object.keys(m).forEach((function(t){"default"!==t&&"__esModule"!==t&&Object.defineProperty(exports,t,{enumerable:!0,get:function(){return m[t]}})}));
//# sourceMappingURL=easy-ecs.js.map
