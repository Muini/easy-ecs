{"mappings":"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","sources":["./core/ecs.js","./core/utils.js","./core/addons.js"],"sourcesContent":["import { UUID } from './utils'\n\nexport class Addon {\n  static get name(){ return this.constructor.name } \n  static onInit = (world) => {}\n  static onStart = (world) => {}\n  static onBeforeUpdate = (world, time) => {}\n  static onAfterUpdate = (world, time) => {}\n}\nexport class World {\n  addons = [];\n  systems = [];\n  systemsList = [];\n  entities = [];\n  constructor(props = {addons: [], systems: []}){\n    this.addons = props.addons\n    props.systems.forEach(system => {\n      this.systems = [...this.systems, new system()]\n    })\n  }\n  addEntity(entity){\n    this.entities.push(entity)\n  }\n  removeEntity(entity){\n    if(this.entities.indexOf(entity) === -1) return console.warn('Easy-ECS: Cannot remove entity from world', entity)\n    this.entities.splice( this.entities.indexOf(entity), 1 )\n  }\n  start(){\n    this.init()\n    this.addons.forEach(addon => addon.onStart(this))\n  }\n  init(){\n    // const now = performance.now()\n    this.addons.forEach(addon => addon.onInit(this))\n    this.systems.forEach(system => {\n      const entities = this.entities.filter(\n        entity => system.dependencies.every(\n          dependency => entity.components.indexOf(dependency.name) >= 0\n        )\n      )\n      system.onInit(entities)\n    })\n    // console.log('init took', performance.now() - now, 'ms\\n')\n  }\n  update(time){\n    // const now = performance.now()\n    this.addons.forEach(addon => addon.onBeforeUpdate(this, time))\n    this.systems.forEach(system => {\n      const entities = this.entities.filter(\n        entity => system.dependencies.every(\n          dependency => entity.components.indexOf(dependency.name) >= 0\n        )\n      )\n      system.onUpdate(entities)\n    })\n    this.addons.forEach(addon => addon.onAfterUpdate(this, time))\n    // console.log('update took', performance.now() - now, 'ms\\n')\n  }\n}\nexport class Entity {\n  id = UUID();\n  components = []\n  world = null\n  static components = []\n  constructor(world, values) {\n    this.constructor.components.forEach(component => {\n      this.addComponent(component, values);\n    })\n    this.world = world;\n    world.addEntity(this);\n  }\n  addComponent(component, values = {}){\n    this.components.push(component.name)\n    component.props.forEach(prop => {\n      this[prop] = values[prop] ? values[prop] : component[prop]\n    })\n  }\n  removeComponent(component, shouldClean = false){\n    this.components.splice(this.components.indexOf(component.name), 1)\n    if(!component.props || !shouldClean) return;\n    component.props.forEach(prop => {\n      delete this[prop]\n    })\n  }\n  serialize(){\n    let data = {}\n    Object.keys(this).forEach(prop => prop !== 'world' ? data[prop] = this[prop] : false)\n    return JSON.stringify(data)\n  }\n  unserialize(json){\n    const props = JSON.parse(json)\n    Object.keys(props).forEach(prop => {\n      this[prop] = props[prop] \n    })\n  }\n  destroy(){\n    this.world.removeEntity(this)\n  }\n}\nexport class Component {\n  static get props(){\n    return Object.keys(this)\n  }\n  static get name(){\n    return this.constructor.name\n  }\n}\nexport class System {\n  get name(){ return this.constructor.name }\n  dependencies = [];\n  onInit = (entities) => {};\n  onUpdate = (entities) => {};\n}\n","export function UUID () {\n  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n    (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n  )\n}\n","import { Addon, Entity } from './ecs'\n\nexport class Time extends Addon {\n  static time = 0;\n  static delta = 0;\n  static elapsed = 0;\n  static onBeforeUpdate = (world, time) => {\n    Time.delta = time - Time.time;\n    Time.time = time;\n    Time.elapsed += Time.delta;\n  }\n}\nexport class Loop extends Addon {\n  static raf = null;\n  static onStart = (world) => {\n    Loop.raf = requestAnimationFrame(world.update.bind(world));\n  }\n  static onBeforeUpdate = (world) => {\n    Loop.raf = requestAnimationFrame(world.update.bind(world));\n  }\n  static stop = () => {\n    cancelAnimationFrame(Loop.raf);\n    Loop.raf = null;\n  }\n  static get isRunning(){\n    return Loop.raf !== null;\n  }\n}\nexport class Input extends Addon {\n  static keypress = null;\n  static keydown = [];\n  static mouse = {x: 0, y: 0};\n  static INPUT_LEFT = 37;\n  static INPUT_RIGHT = 39;\n  static INPUT_UP = 38;\n  static INPUT_DOWN = 40;\n  static onInit = (world) => {\n    document.addEventListener('keydown', evt => {\n      if(Input.keydown.indexOf(evt.keyCode) !== -1) return\n      Input.keydown = [...Input.keydown, evt.keyCode];\n    });\n    document.addEventListener('keyup', evt => {\n      Input.keydown.splice(Input.keydown.indexOf(evt.keyCode), 1);\n    })\n    document.addEventListener('mousemove', evt => {\n      Input.mouse = {x: evt.clientX, y: evt.clientY};\n    });\n  }\n  static onBeforeUpdate = (world) => {\n    Input.keypress = Input.keydown\n  }\n  static onAfterUpdate = (world) => {\n    Input.keypress = null;\n  }\n  static isPressed = (key) => {\n    return Input.keypress.indexOf(key) !== -1\n  } \n}\nexport class Renderer extends Addon {\n  static canvas = null;\n  static ctx = null;\n  static width = 0;\n  static height = 0;\n  static setup = (canvas, width, height) => {\n    Renderer.canvas = canvas\n    Renderer.width = width\n    Renderer.height = height\n    Renderer.ctx = Renderer.canvas.getContext('2d');\n    Renderer.canvas.width = Renderer.width * window.devicePixelRatio;\n    Renderer.canvas.height = Renderer.height * window.devicePixelRatio;\n    Renderer.canvas.style['width'] = Renderer.width;\n    Renderer.canvas.style['height'] = Renderer.height;\n  }\n  static onBeforeUpdate = (world) => {\n    Renderer.ctx.clearRect(0, 0, Renderer.canvas.width, Renderer.canvas.height);\n  }\n}\nexport class SaveSystem extends Addon {\n  static saveGame = (world, saveName) => {\n    const saveFile = {\n      timestamp: Date.now(),\n      entities: world.entities.map(entity => entity.serialize())\n    }\n    localStorage.setItem(`gamesave-${saveName}`, JSON.stringify(saveFile))\n  }\n  static restoreGame = (world, saveName) => {\n    const saveFile = localStorage.getItem(`gamesave-${saveName}`)\n    const saveData = JSON.parse(saveFile);\n    world.entities = []\n    saveData.entities.forEach(entityData => {\n      new Entity(world).unserialize(entityData)\n    })\n  }\n  static saveData = (nameAccess, data) => {\n    localStorage.setItem(`easy-ecs-${nameAccess}`, JSON.stringify(data))\n  }\n  static restoreData = (nameAccess) => {\n    const savedData = localStorage.getItem(`easy-ecs-${nameAccess}`)\n    return savedData ? JSON.parse(savedData) : null\n  }\n}"],"names":["Addon","this","constructor","name","world","time","World","_this","props","arguments","length","undefined","addons","systems","$db83d7f171f043bdd8491f6c49fe6d4$var$_classCallCheck","$db83d7f171f043bdd8491f6c49fe6d4$var$_defineProperty","forEach","system","concat","$db83d7f171f043bdd8491f6c49fe6d4$var$_toConsumableArray","entity","entities","push","indexOf","console","warn","splice","_this2","init","addon","onStart","_this3","onInit","filter","dependencies","every","dependency","components","_this4","onBeforeUpdate","onUpdate","onAfterUpdate","Entity","values","_this5","replace","c","crypto","getRandomValues","Uint8Array","toString","component","addComponent","addEntity","_this6","prop","_this7","shouldClean","_this8","data","Object","keys","JSON","stringify","json","_this9","parse","removeEntity","Component","System","Time","delta","elapsed","Loop","raf","requestAnimationFrame","update","bind","cancelAnimationFrame","Input","x","y","document","addEventListener","evt","keydown","keyCode","$bc8f1ef60e7b47af6b24224a5bc06976$var$_toConsumableArray","mouse","clientX","clientY","keypress","key","Renderer","canvas","width","height","ctx","getContext","window","devicePixelRatio","style","clearRect","SaveSystem","saveName","saveFile","timestamp","Date","now","map","serialize","localStorage","setItem","getItem","saveData","entityData","unserialize","nameAccess","savedData"],"version":3,"file":"easy-ecs.js.map"}