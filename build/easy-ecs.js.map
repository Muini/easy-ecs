{"mappings":"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","sources":["./core/ecs.js","./core/utils.js","./core/addons.js"],"sourcesContent":["import { UUID } from './utils'\n\nexport class Addon {\n  static get name(){ return this.constructor.name } \n  static onInit = (world) => {}\n  static onBeforeUpdate = (world, time) => {}\n  static onAfterUpdate = (world, time) => {}\n}\nexport class World {\n  addons = [];\n  systems = [];\n  systemsList = [];\n  entities = [];\n  constructor(props = {addons: [], systems: []}){\n    this.addons = props.addons\n    props.systems.forEach(system => {\n      this.systems = [...this.systems, new system()]\n    })\n  }\n  addEntity(entity){\n    this.entities.push(entity)\n  }\n  removeEntity(entity){\n    if(this.entities.indexOf(entity) === -1) return console.warn('Easy-ECS: Cannot remove entity from world', entity)\n    this.entities.splice( this.entities.indexOf(entity), 1 )\n  }\n  start(){\n    // const now = performance.now()\n    this.addons.forEach(addon => addon.onInit(this))\n    this.systems.forEach(system => {\n      const entities = this.entities.filter(\n        entity => system.dependencies.every(\n          dependency => entity.components.indexOf(dependency.name) >= 0\n        )\n      )\n      system.onInit(entities)\n    })\n    // console.log('init took', performance.now() - now, 'ms\\n')\n  }\n  update(time){\n    // const now = performance.now()\n    this.addons.forEach(addon => addon.onBeforeUpdate(this, time))\n    this.systems.forEach(system => {\n      const entities = this.entities.filter(\n        entity => system.dependencies.every(\n          dependency => entity.components.indexOf(dependency.name) >= 0\n        )\n      )\n      system.onUpdate(entities)\n    })\n    this.addons.forEach(addon => addon.onAfterUpdate(this, time))\n    // console.log('update took', performance.now() - now, 'ms\\n')\n  }\n}\nexport class Entity {\n  id = UUID();\n  components = []\n  world = null\n  static components = []\n  constructor(world, values) {\n    this.constructor.components.forEach(component => {\n      this.addComponent(component, values);\n    })\n    this.world = world;\n    world.addEntity(this);\n  }\n  addComponent(component, values = {}){\n    component.props.forEach(prop => {\n      if(this[prop]) console.warn(`Easy-ECS: Entity prop ${prop} overwrite by component ${component.name}`, entity)\n      this[prop] = values[prop] ? values[prop] : component[prop]\n    })\n    this.components.push(component.name)\n  }\n  removeComponent(component, shouldClean = false){  \n    if(this.components.indexOf(component.name) === -1) return;\n    this.components.splice(this.components.indexOf(component.name), 1)\n    if(!component.props || !shouldClean) return;\n    component.props.forEach(prop => {\n      delete this[prop]\n    })\n  }\n  serialize(){\n    let data = {}\n    Object.keys(this).forEach(prop => prop !== 'world' ? data[prop] = this[prop] : false)\n    return JSON.stringify(data)\n  }\n  unserialize(json){\n    const props = JSON.parse(json)\n    Object.keys(props).forEach(prop => {\n      this[prop] = props[prop] \n    })\n  }\n  destroy(){\n    this.world.removeEntity(this)\n  }\n}\nexport class Component {\n  static get props(){\n    return Object.keys(this)\n  }\n  static get name(){\n    return this.constructor.name\n  }\n}\nexport class System {\n  get name(){ return this.constructor.name }\n  dependencies = [];\n  onInit = (entities) => {};\n  onUpdate = (entities) => {};\n}\n","export function UUID () {\n  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n    (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n  )\n}\n","import { Addon, Entity } from './ecs'\n\nexport class Time extends Addon {\n  static time = 0;\n  static delta = 0;\n  static elapsed = 0;\n  static onBeforeUpdate = (world, time) => {\n    Time.delta = time - Time.time;\n    Time.time = time;\n    Time.elapsed += Time.delta;\n  }\n}\nexport class Loop extends Addon {\n  static raf = null;\n  static loop = (world) => {\n    Loop.raf = requestAnimationFrame(world.update.bind(world));\n  }\n  static stop = () => {\n    cancelAnimationFrame(Loop.raf);\n    Loop.raf = null;\n  }\n  static onInit = (world) => {\n    Loop.loop(world);\n  }\n  static onBeforeUpdate = (world) => {\n    Loop.loop(world)\n  }\n  static get isRunning(){\n    return Loop.raf !== null;\n  }\n}\nexport class Input extends Addon {\n  static keypress = null;\n  static keydown = [];\n  static mouse = {x: 0, y: 0};\n  static INPUT_LEFT = 'ArrowLeft';\n  static INPUT_RIGHT = 'ArrowRight';\n  static INPUT_UP = 'ArrowUp';\n  static INPUT_DOWN = 'ArrowDown';\n  static onInit = (world) => {\n    document.addEventListener('keydown', evt => {\n      if(Input.keydown.indexOf(evt.code) !== -1) return\n      Input.keydown = [...Input.keydown, evt.code];\n    });\n    document.addEventListener('keyup', evt => {\n      Input.keydown.splice(Input.keydown.indexOf(evt.code), 1);\n    })\n    document.addEventListener('mousemove', evt => {\n      Input.mouse = {x: evt.clientX, y: evt.clientY};\n    });\n  }\n  static onBeforeUpdate = (world) => {\n    Input.keypress = Input.keydown\n  }\n  static onAfterUpdate = (world) => {\n    Input.keypress = null;\n  }\n  static isPressed = (key) => {\n    return Input.keypress.indexOf(key) !== -1\n  } \n}\nexport class Renderer extends Addon {\n  static canvas = null;\n  static ctx = null;\n  static width = 0;\n  static height = 0;\n  static setup = (canvas, width, height) => {\n    Renderer.canvas = canvas\n    Renderer.width = width\n    Renderer.height = height\n    Renderer.ctx = Renderer.canvas.getContext('2d');\n    Renderer.canvas.width = Renderer.width * window.devicePixelRatio;\n    Renderer.canvas.height = Renderer.height * window.devicePixelRatio;\n    Renderer.canvas.style['width'] = Renderer.width;\n    Renderer.canvas.style['height'] = Renderer.height;\n  }\n  static onBeforeUpdate = (world) => {\n    Renderer.ctx.clearRect(0, 0, Renderer.canvas.width, Renderer.canvas.height);\n  }\n}\nexport class SaveSystem extends Addon {\n  static saveGame = (world, saveName) => {\n    const saveFile = {\n      timestamp: Date.now(),\n      entities: world.entities.map(entity => entity.serialize())\n    }\n    localStorage.setItem(`gamesave-${saveName}`, JSON.stringify(saveFile))\n  }\n  static restoreGame = (world, saveName) => {\n    const saveFile = localStorage.getItem(`gamesave-${saveName}`)\n    const saveData = JSON.parse(saveFile);\n    world.entities = []\n    saveData.entities.forEach(entityData => {\n      new Entity(world).unserialize(entityData)\n    })\n  }\n  static saveData = (name, data) => {\n    localStorage.setItem(`data-${name}`, JSON.stringify(data))\n  }\n  static restoreData = (name) => {\n    const savedData = localStorage.getItem(`data-${name}`)\n    return savedData ? JSON.parse(savedData) : null\n  }\n}"],"names":["Addon","this","constructor","name","world","time","World","_this","props","arguments","length","undefined","addons","systems","$db83d7f171f043bdd8491f6c49fe6d4$var$_classCallCheck","$db83d7f171f043bdd8491f6c49fe6d4$var$_defineProperty","forEach","system","concat","$db83d7f171f043bdd8491f6c49fe6d4$var$_toConsumableArray","entity","entities","push","indexOf","console","warn","splice","_this2","addon","onInit","filter","dependencies","every","dependency","components","_this3","onBeforeUpdate","onUpdate","onAfterUpdate","Entity","values","_this4","replace","c","crypto","getRandomValues","Uint8Array","toString","component","addComponent","addEntity","_this5","prop","_this6","shouldClean","_this7","data","Object","keys","JSON","stringify","json","_this8","parse","removeEntity","Component","System","Time","delta","elapsed","Loop","raf","requestAnimationFrame","update","bind","cancelAnimationFrame","loop","Input","x","y","document","addEventListener","evt","keydown","code","$bc8f1ef60e7b47af6b24224a5bc06976$var$_toConsumableArray","mouse","clientX","clientY","keypress","key","Renderer","canvas","width","height","ctx","getContext","window","devicePixelRatio","style","clearRect","SaveSystem","saveName","saveFile","timestamp","Date","now","map","serialize","localStorage","setItem","getItem","saveData","entityData","unserialize","savedData"],"version":3,"file":"easy-ecs.js.map"}