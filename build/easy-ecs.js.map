{"mappings":"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","sources":["./core/utils.js","./core/ecs.js","./index.js","./core/addons/time.js","./core/addons/loop.js","./core/addons/input.js","./core/addons/canvasRenderer.js","./core/addons/saveSystem.js"],"sourcesContent":["export function UUID () {\n  return ([1e7] + -1e3 + -4e3 + -8e3 + -1e11).replace(/[018]/g, c =>\n    (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)\n  )\n}\n","import { UUID } from './utils'\r\n\r\nexport class Addon {\r\n  constructor(){\r\n    throw Error('Easy-ECS: Cannot instantiate class Addon');\r\n  }\r\n  static onInit = (world) => {}\r\n  static onBeforeUpdate = (world, time) => {}\r\n  static onAfterUpdate = (world, time) => {}\r\n}\r\nexport class World {\r\n  addons = [];\r\n  systems = [];\r\n  entities = [];\r\n  constructor(props = {addons: [], systems: []}){\r\n    this.addons = props.addons\r\n    props.systems.forEach(system => {\r\n      this.systems = [...this.systems, new system(this)]\r\n    })\r\n  }\r\n  addEntity(entity){\r\n    this.entities.push(entity)\r\n  }\r\n  removeEntity(entity){\r\n    if(this.entities.indexOf(entity) === -1) return console.warn('Easy-ECS: Cannot remove entity from world', entity)\r\n    this.entities.splice( this.entities.indexOf(entity), 1 )\r\n  }\r\n  getEntitiesWithComponents(componentsArray){\r\n    return componentsArray.length ? this.entities.filter(\r\n      entity => componentsArray.every(\r\n        component => entity.components.indexOf(component.name) >= 0\r\n      )\r\n    ) : this.entities\r\n  }\r\n  getEntitiesOfType(entityConstructor){\r\n    return this.entities.filter(entity => entity.constructor === entityConstructor)\r\n  }\r\n  getEntityById(id){\r\n    return this.entities.find(entity => entity.id === id)\r\n  }\r\n  start(){\r\n    // const now = performance.now()\r\n    this.addons.forEach(addon => addon.onInit(this))\r\n    this.systems.forEach(system => {\r\n      const entities = this.getEntitiesWithComponents(system.dependencies)\r\n      system.onInit(entities)\r\n    })\r\n    // console.log('init took', performance.now() - now, 'ms\\n')\r\n  }\r\n  update(time){\r\n    // const now = performance.now()\r\n    this.addons.forEach(addon => addon.onBeforeUpdate(this, time))\r\n    this.systems.forEach(system => {\r\n      const entities = this.getEntitiesWithComponents(system.dependencies)\r\n      system.onUpdate(entities)\r\n    })\r\n    this.addons.forEach(addon => addon.onAfterUpdate(this, time))\r\n    // console.log('update took', performance.now() - now, 'ms\\n')\r\n  }\r\n}\r\nexport class Entity {\r\n  id = UUID();\r\n  components = []\r\n  world = null\r\n  static components = []\r\n  constructor(world, values) {\r\n    this.constructor.components.forEach(component => {\r\n      this.addComponent(component, values);\r\n    })\r\n    this.world = world;\r\n    world.addEntity(this);\r\n  }\r\n  addComponent(component, values = {}){\r\n    component.props.forEach(prop => {\r\n      if(this[prop] && prop !== 'name') console.warn(`Easy-ECS: Entity prop ${prop} overwrite by component ${component.name}`, this)\r\n      this[prop] = values[prop] ? values[prop] : component[prop]\r\n    })\r\n    this.components.push(component.name)\r\n  }\r\n  removeComponent(component, shouldClean = false){  \r\n    if(this.components.indexOf(component.name) === -1) return;\r\n    this.components.splice(this.components.indexOf(component.name), 1)\r\n    if(!component.props || !shouldClean) return;\r\n    component.props.forEach(prop => {\r\n      delete this[prop]\r\n    })\r\n  }\r\n  serialize(){\r\n    let data = {}\r\n    Object.keys(this).forEach(prop => (prop !== 'world' && prop !== 'name') ? data[prop] = this[prop] : false)\r\n    return JSON.stringify(data)\r\n  }\r\n  unserialize(json){\r\n    const props = JSON.parse(json)\r\n    Object.keys(props).forEach(prop => {\r\n      this[prop] = props[prop] \r\n    })\r\n  }\r\n  destroy(){\r\n    this.world.removeEntity(this)\r\n  }\r\n}\r\nexport class Component {\r\n  static name = 'Unnamed Component'\r\n  constructor(){\r\n    throw Error('Easy-ECS: Cannot instantiate class Component');\r\n  }\r\n  static get props(){\r\n    let returnProps = []\r\n    for(let prop in this){\r\n      returnProps.push(prop)\r\n    }\r\n    return returnProps\r\n  }\r\n}\r\nexport class System {\r\n  dependencies = [];\r\n  world = null;\r\n  constructor(world){\r\n    this.world = world;\r\n  }\r\n  onInit = (entities) => {};\r\n  onUpdate = (entities) => {};\r\n}\r\n","export * from './core/ecs';\r\nexport * from './core/addons';","import { Addon } from '../ecs'\r\n\r\nexport class Time extends Addon {\r\n  static time = 0;\r\n  static delta = 0;\r\n  static elapsed = 0;\r\n  static onBeforeUpdate = (world, time) => {\r\n    Time.delta = time - Time.time;\r\n    Time.time = time;\r\n    Time.elapsed += Time.delta;\r\n  }\r\n}","import { Addon } from '../ecs'\r\n\r\nlet _raf = null;\r\nexport class Loop extends Addon {\r\n  static loop = (world) => {\r\n    _raf = requestAnimationFrame(world.update.bind(world));\r\n  }\r\n  static stop = () => {\r\n    cancelAnimationFrame(_raf);\r\n    _raf = null;\r\n  }\r\n  static onInit = (world) => {\r\n    Loop.loop(world);\r\n  }\r\n  static onBeforeUpdate = (world) => {\r\n    Loop.loop(world)\r\n  }\r\n  static get isRunning(){\r\n    return _raf !== null;\r\n  }\r\n}","import { Addon } from '../ecs'\r\n\r\nlet _keydown = [];\r\nexport class Input extends Addon {\r\n  static keypress = null;\r\n  static mouse = {x: 0, y: 0};\r\n  static INPUT_LEFT = 'ArrowLeft';\r\n  static INPUT_RIGHT = 'ArrowRight';\r\n  static INPUT_UP = 'ArrowUp';\r\n  static INPUT_DOWN = 'ArrowDown';\r\n  static INPUT_SPACE = 'Space';\r\n  static onInit = (world) => {\r\n    document.addEventListener('keydown', evt => {\r\n      if(_keydown.indexOf(evt.code) !== -1) return\r\n      _keydown = [..._keydown, evt.code];\r\n    });\r\n    document.addEventListener('keyup', evt => {\r\n      _keydown.splice(_keydown.indexOf(evt.code), 1);\r\n    })\r\n    document.addEventListener('mousemove', evt => {\r\n      Input.mouse = {x: evt.clientX, y: evt.clientY};\r\n    });\r\n  }\r\n  static onBeforeUpdate = (world) => {\r\n    Input.keypress = _keydown;\r\n  }\r\n  static onAfterUpdate = (world) => {\r\n    Input.keypress = null;\r\n  }\r\n  static isPressed = (key) => {\r\n    return Input.keypress.indexOf(key) !== -1\r\n  } \r\n}","import { Addon } from '../ecs'\r\n\r\nexport class Renderer extends Addon {\r\n  static canvas = null;\r\n  static ctx = null;\r\n  static width = 0;\r\n  static height = 0;\r\n  static worldScale = 1;\r\n  static setup = (canvas, width, height, worldScale = 1) => {\r\n    Renderer.canvas = canvas\r\n    Renderer.width = width\r\n    Renderer.height = height\r\n    Renderer.worldScale = worldScale\r\n    Renderer.ctx = Renderer.canvas.getContext('2d');\r\n    Renderer.canvas.width = Renderer.width * Renderer.worldScale;\r\n    Renderer.canvas.height = Renderer.height * Renderer.worldScale;\r\n    Renderer.canvas.style['width'] = Renderer.width;\r\n    Renderer.canvas.style['height'] = Renderer.height;\r\n    window.addEventListener('resize', () => {\r\n       Renderer.onResize()\r\n    })\r\n  }\r\n  static onResize = () => {}\r\n  static onBeforeUpdate = (world) => {\r\n    Renderer.ctx.clearRect(0, 0, Renderer.canvas.width, Renderer.canvas.height);\r\n  }\r\n}","import { Addon, Entity } from '../ecs'\r\n\r\nexport class SaveSystem extends Addon {\r\n  static saveWorld = (world, saveName) => {\r\n    const saveFile = {\r\n      timestamp: Date.now(),\r\n      entities: world.entities.map(entity => entity.serialize())\r\n    }\r\n    localStorage.setItem(`worldsave-${saveName}`, JSON.stringify(saveFile))\r\n    return saveFile\r\n  }\r\n  static restoreWorld = (world, saveName) => {\r\n    const saveFile = localStorage.getItem(`worldsave-${saveName}`)\r\n    const saveData = JSON.parse(saveFile);\r\n    world.entities = []\r\n    saveData.entities.forEach(entityData => {\r\n      new Entity(world).unserialize(entityData)\r\n    })\r\n  }\r\n  static saveData = (name, data) => {\r\n    localStorage.setItem(`data-${name}`, JSON.stringify(data))\r\n  }\r\n  static restoreData = (name) => {\r\n    const savedData = localStorage.getItem(`data-${name}`)\r\n    return savedData ? JSON.parse(savedData) : null\r\n  }\r\n}"],"names":["replace","c","crypto","getRandomValues","Uint8Array","toString","Addon","$db83d7f171f043bdd8491f6c49fe6d4$var$_classCallCheck","this","Error","world","time","World","_this","props","arguments","length","undefined","addons","systems","$db83d7f171f043bdd8491f6c49fe6d4$var$_defineProperty","forEach","system","concat","$db83d7f171f043bdd8491f6c49fe6d4$var$_toConsumableArray","entity","entities","push","indexOf","console","warn","splice","componentsArray","filter","every","component","components","name","entityConstructor","constructor","id","find","_this2","addon","onInit","getEntitiesWithComponents","dependencies","_this3","onBeforeUpdate","onUpdate","onAfterUpdate","Entity","values","_this4","$d690541ea54d69aa1e7beb3c5a17d62$exports","UUID","addComponent","addEntity","_this5","prop","_this6","shouldClean","_this7","data","Object","keys","JSON","stringify","json","_this8","parse","removeEntity","Component","returnProps","System","$db83d7f171f043bdd8491f6c49fe6d4$exports","key","defineProperty","exports","enumerable","get","Time","delta","elapsed","_raf","Loop","requestAnimationFrame","update","bind","cancelAnimationFrame","loop","_keydown","Input","x","y","document","addEventListener","evt","code","$cea16676b259bf7f4f678c94e790eb7$var$_toConsumableArray","mouse","clientX","clientY","keypress","Renderer","canvas","width","height","worldScale","ctx","getContext","style","window","onResize","clearRect","SaveSystem","saveName","saveFile","timestamp","Date","now","map","serialize","localStorage","setItem","getItem","saveData","entityData","unserialize","savedData","$c317bef5c0f905a6d703e4378442086$exports"],"version":3,"file":"easy-ecs.js.map"}