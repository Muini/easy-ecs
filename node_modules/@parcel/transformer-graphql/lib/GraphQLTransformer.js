"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _plugin = require("@parcel/plugin");

var _default = new _plugin.Transformer({
  async transform({
    asset,
    options,
    resolve
  }) {
    const {
      parse,
      print,
      Source,
      stripIgnoredCharacters
    } = await options.packageManager.require('graphql', asset.filePath, {
      autoinstall: options.autoinstall
    });
    const {
      processDocumentImports
    } = await options.packageManager.require('graphql-import-macro', asset.filePath, {
      autoinstall: options.autoinstall
    });
    const document = parse(new Source((await asset.getCode()), asset.filePath));
    const expandedDocument = await processDocumentImports(document, async function (to, from) {
      const filePath = await resolve(to, from);
      asset.addIncludedFile({
        filePath
      });
      return parse(new Source((await options.inputFS.readFile(filePath, 'utf-8')), filePath));
    });
    const generated = asset.env.minify ? stripIgnoredCharacters(print(expandedDocument)) : print(expandedDocument);
    asset.type = 'js';
    asset.setCode(`module.exports=${JSON.stringify(generated)};`);
    return [asset];
  }

});

exports.default = _default;