"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.load = load;
exports.preSerialize = preSerialize;

var _path = _interopRequireDefault(require("path"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

async function load({
  config
}) {
  let configFile = await config.getConfig(['.lessrc', '.lessrc.js'], {
    packageKey: 'less'
  });
  let configContents = {};

  if (configFile != null) {
    configContents = configFile.contents;
  } // Rewrites urls to be relative to the provided filename


  configContents.rewriteUrls = 'all';
  configContents.plugins = configContents.plugins || []; // This should enforce the config to be reloaded on every run as it's JS

  let isDynamic = configFile && _path.default.extname(configFile.filePath) === '.js';

  if (isDynamic) {
    config.shouldInvalidateOnStartup();
    config.shouldReload();
  }

  return config.setResult({
    isStatic: !isDynamic,
    config: configContents
  });
}

function preSerialize(config) {
  if (!config.result) return; // Ensure we dont pass functions to the serialiser

  if (!config.result.isStatic) {
    config.result.config = {};
  }
}